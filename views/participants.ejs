<!-- done, Lists all participants. (step 2 needs to work on.)On dropdown of participant show their attended and registered events as well as any corresponding survey results 
(show the overall score or NPS bucket, on hover or drop down show every score) -->
<!-- Include filters for event name and type. Then show only the participants for those things, (keep the dropdown showing their other attended events?) -->
<!-- for each participant include a link to the view participant page -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Participants</title>
</head>
<body>

  <h1>Participants</h1>

  <!-- Error / flash message (optional) -->
  <% if (typeof error_message !== "undefined" && error_message) { %>
    <p style="color:red;"><%= error_message %></p>
  <% } %>

  <!-- Simple filters (event name / type) - logic can be added later -->
  <form method="get" action="/participants">
    <label>
      Event Name:
      <input type="text" name="eventName" value="<%= typeof eventName !== 'undefined' ? eventName : '' %>">
    </label>
    <label>
      Event Type:
      <input type="text" name="eventType" value="<%= typeof eventType !== 'undefined' ? eventType : '' %>">
    </label>
    <button type="submit">Filter</button>
  </form>

  <hr>

  <!-- Participants list -->
  <table border="1" cellpadding="4" cellspacing="0">
    <thead>
      <tr>
        <th>Email</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Date of Birth</th>
        <th>Role</th>
        <th>Phone Number</th>
        <th>City</th>
        <th>State</th>
        <th>Zip</th>
        <th>Field of Interest</th>
        <th>Actions</th>
      </tr>
    </thead>
<tbody>
  <% if (participants && participants.length > 0) { %>

    <% for (let iCount = 0; iCount < participants.length; iCount++) { 
         let p = participants[iCount];
    %>
      <tr>
        <td><%= p.email %></td>
        <td><%= p.participantfirstname %></td>
        <td><%= p.participantlastname %></td>
        <td><%= p.participantdob %></td>
        <td><%= p.participantrole %></td>
        <td><%= p.participantphone %></td>
        <td><%= p.participantcity %></td>
        <td><%= p.participantstate %></td>
        <td><%= p.participantzip %></td>
        <td><%= p.participantfieldofinterest %></td>
        <td>
          <a href="/participants/<%= p.participantid %>">View</a>

          <% if (isAdmin) { %>
            |
            <a href="/participants/<%= p.participantid %>/edit">Edit</a>
            |
            <form action="/deleteparticipants/<%= p.participantid %>" method="POST" style="display:inline;">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button type="submit" onclick="return confirm('Delete this participant?');">
                Delete
              </button>
            </form>
          <% } %>
                      
          <details style="margin-top: 4px;">
            <summary>Quick view</summary>
            <ul>
              <li>Email: <%= p.email %></li>.
              <li>Role: <%= p.participantrole %></li>
              <li>City/State: <%= p.participantcity %>, <%= p.participantstate %></li>
              <li>Field of interest: <%= p.participantfieldofinterest %></li>
            </ul>
            <p style="margin-top: 4px;">
              <a href="/participants/<%= p.participantid %>">Open full details â†’</a>
            </p>
          </details>          
        </td>
      </tr>
    <% } %>

  <% } else { %>
    <tr>
      <td colspan="11">No participants found.</td>
    </tr>
  <% } %>
</tbody>

  <div style="margin-top: 16px;">
    <% if (currentPage > 1) { %>
      <a href="/participants?page=<%= currentPage - 1 %>">Prev</a>
    <% } %>

    <span>Page <%= currentPage %> of <%= totalPages %></span>

    <% if (currentPage < totalPages) { %>
      <a href="/participants?page=<%= currentPage + 1 %>">Next</a>
    <% } %>
  </div>

  </table>

  <!-- Manager-only: Add new participant -->
  <% if (isAdmin) { %>
    <p>
      <a href="/participants/add">Add New Participant</a>
    </p>
  <% } %>

</body>
</html>
