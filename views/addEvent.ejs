<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/css/style.css">
  <meta charset="UTF-8">
  <title>Add Event</title>
</head>
<body>
<div class="layout">
  <%- include('partials/userbar') %>
  <%- include('partials/sidebar', { active: 'events' }) %>

  <main class="main">
    <h1>Add New Event</h1>
    <p><a href="/events" class="btn secondary-btn">Back to Events</a></p>

    <% if (error_message) { %>
      <div class="alert alert-error"><%= error_message %></div>
    <% } %>

    <form method="post" action="/events/new" class="form-card form-shell">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">

      <table>
        <tr>
          <th>Event*</th>
          <td>
            <select name="eventid" required>
              <option value="">Select an event</option>
              <% if (eventsList && eventsList.length) { %>
                <% eventsList.forEach(function(ev) { %>
                  <option value="<%= ev.eventid %>" <%= String(selectedEventId) === String(ev.eventid) ? 'selected' : '' %>>
                    <%= ev.eventname %> (<%= ev.eventtype || 'No type' %>)
                  </option>
                <% }); %>
              <% } %>
            </select>
          </td>
        </tr>
        <tr>
          <th>Location</th>
          <td><input type="text" name="eventlocation" value="<%= eventlocation || '' %>"></td>
        </tr>
        <tr>
          <th>Occurrence</th>
          <td>
            <select name="eventrecurrencepattern">
              <option value="" <%= !eventrecurrencepattern ? 'selected' : '' %>></option>
              <option value="Weekly"  <%= eventrecurrencepattern === 'Weekly'  ? 'selected' : '' %>>Weekly</option>
              <option value="Monthly" <%= eventrecurrencepattern === 'Monthly' ? 'selected' : '' %>>Monthly</option>
              <option value="Annually"<%= eventrecurrencepattern === 'Annually'? 'selected' : '' %>>Annually</option>
            </select>
          </td>
        </tr>
        <tr>
          <th>Start Date / Time</th>
          <td><input type="datetime-local" name="eventdatetimestart" required></td>
        </tr>
        <tr>
          <th>End Date / Time</th>
          <td><input type="datetime-local" name="eventdatetimeend"></td>
        </tr>
        <tr>
          <th>Capacity</th>
          <td><input type="number" min="0" name="eventcapacity" value="<%= eventcapacity || '' %>"></td>
        </tr>
        <tr>
          <th>Registration Deadline</th>
          <td><input type="datetime-local" name="eventregistrationdeadline"></td>
        </tr>
      </table>

      <div class="form-actions">
        <button type="submit">Create Event</button>
      </div>
    </form>
  </main>
</div>
</body>
</html>
