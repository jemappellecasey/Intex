<!-- For managers only? -->


<!-- Show all the events they attended and are registered for, show their earliest and latest registration date, show their average overall survey score?, 
show all their milestones, show their email, first, and last name, their DOB, Phone, City, State, Zip, Origin, Origin Type, and Field of interest -->


<!DOCTYPE html>
<html lang="en">
<head>
  <title>Participant Details</title>
  <%- include('partials/head') %>
</head>
<body>
<div class="layout">
  <%- include('partials/userbar') %>
  <%- include('partials/sidebar', { active: 'participants' }) %>
  <main class="main">

  <h1>Participant Details</h1>

  <% if (!participant) { %>
    <!-- Participant not found -->
    <div class="alert alert-error"><%= error_message %></div>
    <p><a href="/participants">Back to Participants List</a></p>
  <% } else { %>

    <% if (error_message && error_message !== '') { %>
      <div class="alert alert-error"><%= error_message %></div>
    <% } %>

    <!-- Basic participant information -->
    <section>
      <h2>Basic Information</h2>
      <table>
        <tr>
          <th>Email</th>
          <td><%= participant.email %></td>
        </tr>
        <tr>
          <th>First Name</th>
          <td><%= participant.participantfirstname %></td>
        </tr>
        <tr>
          <th>Last Name</th>
          <td><%= participant.participantlastname %></td>
        </tr>
        <tr>
          <th>Date of Birth</th>
          <td>
            <% if (participant.participantdob) { %>
              <%= participant.participantdob.toISOString
                    ? participant.participantdob.toISOString().slice(0, 10)
                    : participant.participantdob %>
            <% } else { %>
              N/A
            <% } %>
          </td>
        </tr>
        <tr>
          <th>Role</th>
          <td><%= participant.participantrole || 'N/A' %></td>
        </tr>
        <tr>
          <th>Phone Number</th>
          <td><%= participant.participantphone || 'N/A' %></td>
        </tr>
        <tr>
          <th>City</th>
          <td><%= participant.participantcity || 'N/A' %></td>
        </tr>
        <tr>
          <th>State</th>
          <td><%= participant.participantstate || 'N/A' %></td>
        </tr>
        <tr>
          <th>Zip</th>
          <td><%= participant.participantzip || 'N/A' %></td>
        </tr>
        <tr>
          <th>Field of Interest</th>
          <td><%= participant.participantfieldofinterest || 'N/A' %></td>
        </tr>
        <tr>
          <th>Origin</th>
          <td><%= participant.participantorigin || 'N/A' %></td>
        </tr>
        <tr>
          <th>Origin Type</th>
          <td><%= participant.participantorigintype || 'N/A' %></td>
        </tr>
      </table>
    </section>

    <hr>

    <!-- Summary metrics -->
    <section>
      <h2>Summary</h2>
      <ul>
        <li>
          First Registration:
          <% if (firstRegistration) { %>
            <%= (new Date(firstRegistration)).toISOString().slice(0, 10) %>
          <% } else { %> N/A <% } %>
        </li>
        <li>
          Latest Registration:
          <% if (lastRegistration) { %>
            <%= (new Date(lastRegistration)).toISOString().slice(0, 10) %>
          <% } else { %> N/A <% } %>
        </li>
        <li>Number of Surveys: <%= surveyCount %></li>
        <li>
          Average Overall Survey Score:
          <% if (avgOverallScore) { %>
            <%= Number(avgOverallScore).toFixed(2) %>
          <% } else { %> N/A <% } %>
        </li>
      </ul>
    </section>

    <hr>

    <!-- Event participation history -->
    <section>
      <h2>Event History</h2>
      <% if (events && events.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>Event Title</th>
              <th>Event Type</th>
              <th>Start Date/Time</th>
              <th>Registration Status</th>
              <th>Check-in Time</th>
              <th>Attendance Flag</th>
              <th>Registration Created At</th>
            </tr>
          </thead>
          <tbody>
          <% events.forEach(function(ev) { %>
            <tr>
              <td><%= ev.eventtitle %></td>
              <td><%= ev.eventtype %></td>
              <td>
                <% if (ev.eventdatetimestart) { %>
                  <%= (new Date(ev.eventdatetimestart))
                        .toISOString().slice(0, 16).replace('T', ' ') %>
                <% } else { %> N/A <% } %>
              </td>
              <td><%= ev.registrationstatus || 'N/A' %></td>
              <td>
                <% if (ev.registrationcheckintime) { %>
                  <%= (new Date(ev.registrationcheckintime))
                        .toISOString().slice(0, 16).replace('T', ' ') %>
                <% } else { %> N/A <% } %>
              </td>
              <td><%= ev.registrationattendanceflag ? 'Yes' : 'No' %></td>
              <td>
                <% if (ev.registrationcreatedat) { %>
                  <%= (new Date(ev.registrationcreatedat))
                        .toISOString().slice(0, 16).replace('T', ' ') %>
                <% } else { %> N/A <% } %>
              </td>
            </tr>
          <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No event history found for this participant.</p>
      <% } %>
    </section>

    <hr>

    <!-- Survey results -->
    <section>
      <h2>Post-Event Surveys</h2>
      <% if (surveys && surveys.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>Event Title</th>
              <th>Event Start</th>
              <th>Satisfaction</th>
              <th>Usefulness</th>
              <th>Instructor</th>
              <th>Recommendation</th>
              <th>Overall</th>
              <th>Submission Date</th>
            </tr>
          </thead>
          <tbody>
          <% surveys.forEach(function(s) { %>
            <tr>
              <td><%= s.eventtitle %></td>
              <td>
                <% if (s.eventdatetimestart) { %>
                  <%= (new Date(s.eventdatetimestart))
                        .toISOString().slice(0, 16).replace('T', ' ') %>
                <% } else { %> N/A <% } %>
              </td>
              <td><%= s.surveysatisfactionscore %></td>
              <td><%= s.surveyusefulnessscore %></td>
              <td><%= s.surveyinstructorscore %></td>
              <td><%= s.surveyrecommendationscore %></td>
              <td><%= s.surveyoverallscore %></td>
              <td>
                <% if (s.surveysubmissiondate) { %>
                  <%= (new Date(s.surveysubmissiondate))
                        .toISOString().slice(0, 16).replace('T', ' ') %>
                <% } else { %> N/A <% } %>
              </td>
            </tr>
          <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No surveys recorded for this participant.</p>
      <% } %>
    </section>

    <hr>

    <!-- Milestones -->
    <section>
      <h2>Milestones</h2>
      <% if (milestones && milestones.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>Title</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
          <% milestones.forEach(function(m) { %>
            <tr>
              <td><%= m.milestonetitle %></td>
              <td>
                <% if (m.milestonedate) { %>
                  <%= (new Date(m.milestonedate)).toISOString().slice(0, 10) %>
                <% } else { %> N/A <% } %>
              </td>
            </tr>
          <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No milestones recorded for this participant.</p>
      <% } %>
    </section>

    <hr>

    <!-- Donation history -->
    <section>
      <h2>Donations</h2>
      <% if (donations && donations.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
          <% donations.forEach(function(d) { %>
            <tr>
              <td>
                <% if (d.donationdate) { %>
                  <%= (new Date(d.donationdate)).toISOString().slice(0, 10) %>
                <% } else { %> N/A <% } %>
              </td>
              <td><%= d.donationamount %></td>
            </tr>
          <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No donations recorded for this participant.</p>
      <% } %>
    </section>

    <hr>

    <!-- Back / Edit links -->
    <p>
      <a href="/participants">Back to Participants List</a>
      <% if (isManager) { %>
        | <a href="/participants/<%= participant.participantid %>/edit">Edit Participant</a>
      <% } %>
    </p>

  <% } %>
  </main>
</div>
</body>
</html>
