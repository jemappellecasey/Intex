<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/css/style.css">

  <meta charset="UTF-8">
  <title>Edit Survey</title>
</head>
<body>

  <h1>Edit Survey</h1>

  <!-- Error message -->
  <% if (error_message) { %>
    <div class="alert alert-error"><%= error_message %></div>
  <% } %>

  <!-- Navigation -->
  <p>
    <a href="/surveys">Back to Survey List</a>
  </p>

  <% if (!survey) { %>
    <p>Survey not found.</p>
  <% } else { %>

    <!-- Basic info: event and participant (read-only) -->
    <section>
      <h2>Basic Information</h2>
      <table>
        <tr>
          <th>Event Name</th>
          <td><%= survey.eventname || 'N/A' %></td>
        </tr>
        <tr>
          <th>Event Start</th>
          <td>
            <% if (survey.eventdatetimestart) { %>
              <%= new Date(survey.eventdatetimestart).toLocaleString() %>
            <% } else { %> N/A <% } %>
          </td>
        </tr>
        <tr>
          <th>Participant</th>
          <td>
            <%= survey.participantfirstname || '' %>
            <%= survey.participantlastname  || '' %>
          </td>
        </tr>
        <tr>
          <th>Participant Email</th>
          <td><%= survey.email || 'N/A' %></td>
        </tr>
        <tr>
          <th>Submission Date</th>
          <td>
            <% if (survey.surveysubmissiondate) { %>
              <%= new Date(survey.surveysubmissiondate).toLocaleString() %>
            <% } else { %> N/A <% } %>
          </td>
        </tr>
      </table>
    </section>

    <hr>

    <!-- Editable scores -->
    <section>
      <h2>Edit Scores</h2>

      <!-- Main update form -->
      <form method="post" action="/surveys/<%= survey.surveyid %>/edit">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">

        <table>
          <tr>
            <th>Satisfaction (1–5)</th>
            <td>
              <select name="surveysatisfactionscore" required>
                <% for (let i = 1; i <= 5; i++) { %>
                  <option value="<%= i %>"
                    <%= Number(survey.surveysatisfactionscore) === i ? 'selected' : '' %>>
                    <%= i %>
                  </option>
                <% } %>
              </select>
            </td>
          </tr>

          <tr>
            <th>Usefulness (1–5)</th>
            <td>
              <select name="surveyusefulnessscore" required>
                <% for (let i = 1; i <= 5; i++) { %>
                  <option value="<%= i %>"
                    <%= Number(survey.surveyusefulnessscore) === i ? 'selected' : '' %>>
                    <%= i %>
                  </option>
                <% } %>
              </select>
            </td>
          </tr>

          <tr>
            <th>Instructor (1–5)</th>
            <td>
              <select name="surveyinstructorscore" required>
                <% for (let i = 1; i <= 5; i++) { %>
                  <option value="<%= i %>"
                    <%= Number(survey.surveyinstructorscore) === i ? 'selected' : '' %>>
                    <%= i %>
                  </option>
                <% } %>
              </select>
            </td>
          </tr>

          <tr>
            <th>Recommendation (1–5)</th>
            <td>
              <select name="surveyrecommendationscore" required>
                <% for (let i = 1; i <= 5; i++) { %>
                  <option value="<%= i %>"
                    <%= Number(survey.surveyrecommendationscore) === i ? 'selected' : '' %>>
                    <%= i %>
                  </option>
                <% } %>
              </select>
            </td>
          </tr>

          <tr>
            <th>Overall (1–5)</th>
            <td>
              <select name="surveyoverallscore" required>
                <% for (let i = 1; i <= 5; i++) { %>
                  <option value="<%= i %>"
                    <%= Number(survey.surveyoverallscore) === i ? 'selected' : '' %>>
                    <%= i %>
                  </option>
                <% } %>
              </select>
            </td>
          </tr>
        </table>

        <p>
          <button type="submit">Save Changes</button>
          <a href="/surveys">Cancel</a>
        </p>
      </form>
    </section>

    <hr>

    <!-- Delete button (manager only) -->
    <% if (isManager) { %>
      <section>
        <h2>Delete This Survey</h2>
        <form method="post" action="/surveys/<%= survey.surveyid %>/delete">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <p>
            <button type="submit" onclick="return confirm('Are you sure you want to delete this survey?');">
              Delete Survey
            </button>
          </p>
        </form>
      </section>
    <% } %>

  <% } %>

</body>
</html>
