<!DOCTYPE html>
<html lang="en">
<head>
  <title>Edit Event</title>
  <%- include('partials/head') %>
</head>
<body>
<div class="layout">
  <%- include('partials/userbar') %>
  <%- include('partials/sidebar', { active: 'events' }) %>
  <main class="main">

<h1>Edit Event</h1>

<!-- Show error message if any -->
<% if (error_message && error_message !== '') { %>
  <div class="alert alert-error"><%= error_message %></div>
<% } %>
<% if (typeof success_message !== 'undefined' && success_message) { %>
  <div class="alert alert-success"><%= success_message %></div>
  <script>
    // Provide an immediate confirmation pop-up after successful save and return to Events
    window.addEventListener('DOMContentLoaded', function () {
      alert('<%= success_message %>');
      window.location.href = '/events';
    });
  </script>
<% } %>

<!-- If event is not found, show message and stop -->
<% if (!event) { %>
  <p>Event not found.</p>
  <p><a href="/events" class="btn secondary-btn">Back to Events</a></p>
  </main>
</div>
</body>
</html>
<% return; } %>

<!-- =============================== -->
<!-- EDIT EVENT MAIN FORM            -->
<!-- =============================== -->
<section>
  <h2>Event Details</h2>

  <!-- Main update form -->
  <form method="post" action="/events/<%= event.eventdetailsid %>/edit">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">

    <table>
      <tr>
        <th>Event ID</th>
        <td><%= event.eventid %> (Details ID: <%= event.eventdetailsid %>)</td>
      </tr>

      <tr>
        <th>Event Name</th>
        <td>
          <input type="text"
                 name="eventname"
                 value="<%= event.eventname || '' %>"
                 required>
        </td>
      </tr>

      <tr>
        <th>Event Type</th>
        <td>
          <input type="text"
                 name="eventtype"
                 value="<%= event.eventtype || '' %>">
        </td>
      </tr>

      <tr>
        <th>Description</th>
        <td>
          <textarea name="eventdescription" rows="4" cols="50"><%= event.eventdescription || '' %></textarea>
        </td>
      </tr>

      <tr>
        <th>Location</th>
        <td>
          <input type="text"
                 name="eventlocation"
                 value="<%= event.eventlocation || '' %>">
        </td>
      </tr>

      <tr>
        <th>Start Date / Time</th>
        <td>
          <input type="datetime-local"
                 name="eventdatetimestart"
                 value="<% if (event.eventdatetimestart) { %><%= new Date(event.eventdatetimestart).toISOString().slice(0,16) %><% } %>">
        </td>
      </tr>

      <tr>
        <th>End Date / Time</th>
        <td>
          <input type="datetime-local"
                 name="eventdatetimeend"
                 value="<% if (event.eventdatetimeend) { %><%= new Date(event.eventdatetimeend).toISOString().slice(0,16) %><% } %>">
        </td>
      </tr>

      <tr>
        <th>Capacity</th>
        <td>
          <input type="number"
                 name="eventcapacity"
                 min="0"
                 value="<%= event.eventcapacity != null ? event.eventcapacity : '' %>">
        </td>
      </tr>

      <tr>
        <th>Registration Deadline</th>
        <td>
          <input type="datetime-local"
                 name="eventregistrationdeadline"
                 value="<% if (event.eventregistrationdeadline) { %><%= new Date(event.eventregistrationdeadline).toISOString().slice(0,16) %><% } %>">
        </td>
      </tr>
    </table>

    <p>
      <button type="submit">Save Changes</button>
      <a href="/events" class="btn secondary-btn" style="margin-left:8px;">Cancel</a>
    </p>
  </form>
</section>

<hr>

<!-- =============================== -->
<!-- OPTIONAL: QUICK STATS (READ-ONLY) -->
<!-- If you pass these from the route, you can show them -->
<% if (typeof registeredCount !== 'undefined' || typeof attendedCount !== 'undefined') { %>
<section>
  <h2>Quick Event Statistics</h2>
  <ul>
    <% if (typeof registeredCount !== 'undefined') { %>
      <li>Registered Participants: <%= registeredCount %></li>
    <% } %>
    <% if (typeof attendedCount !== 'undefined') { %>
      <li>Attended Participants: <%= attendedCount %></li>
    <% } %>
  </ul>
</section>
<% } %>

<hr>

<p><a href="/events">Back to Events</a></p>

  </main>
</div>
</body>
</html>
