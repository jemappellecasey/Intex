<!-- After login the user or manager, they will come to check this page and see the
 Participants / Events / Surveys / Milestones / Donations, chart and manager view -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ella Rises Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    .layout { display: flex; gap: 16px; min-height: 100vh; }
    .sidebar { min-width: 180px; border-right: 1px solid #ddd; padding: 12px 16px; }
    .sidebar h2 { margin-top: 0; font-size: 18px; }
    .sidebar a { display: block; margin: 6px 0; color: #333; text-decoration: none; }
    .sidebar a.active { font-weight: bold; }
    .main { flex: 1; padding: 16px; }
  </style>
  
</head>

<body>
<div class="layout">

  <!-- Sidebar navigation -->
  <aside class="sidebar">
    <h2>Ella Rises</h2>
    <nav>
      <a href="/dashboard" class="active">Dashboard</a>
      <a href="/participants">Participants</a>
      <a href="/events">Events</a>
      <a href="/surveys">Surveys</a>
      <a href="/milestones">Milestones</a>
      <a href="/donations">Donations</a>

      <% if (isManager) { %>
        <hr />
        <a href="/admin/settings">Special Settings (Admin)</a>
      <% } %>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="main">
    <header class="top-header">
      <h1>Dashboard</h1>
      <div class="user-info">
        Logged in as <strong><%= Username %></strong>
        <a href="/logout" class="logout-btn">Logout</a>
      </div>
    </header>

    <section class="description">
      This dashboard provides insights into event effectiveness, participant
      experience, milestone achievements, and long-term STEAM outcomes.
    </section>

    <!-- KPI section -->
    <section class="kpi-row">
      <div class="kpi-card">
        <h3>STEAM Major Rate</h3>
        <div class="kpi-value">
          <%= typeof steamMajorRate !== 'undefined' ? steamMajorRate + '%' : '--%' %>
        </div>
      </div>
      <div class="kpi-card">
        <h3>STEAM Job Rate</h3>
        <div class="kpi-value">
          <%= typeof steamJobRate !== 'undefined' ? steamJobRate + '%' : '--%' %>
        </div>
      </div>
    </section>

    <!-- Visualization section -->
    <section class="grid">

      <!-- Tableau embed -->
      <div class="card">
        <h3>Event & Participant Experience (Tableau)</h3>
        <p>
          Explore survey scores, event outcomes, and demographic insights
          using this interactive Tableau dashboard.
        </p>

        <!-- Tableau iframe -->
        <!-- Tableau embed -->
        <div class="tableau-container" style="padding:0; border:none;">
          <div class='tableauPlaceholder' id='vizMainDashboard' style='position: relative'>
            <noscript>
              <a href='#'>
                <img alt='Dashboard 1 '
                    src='https://public.tableau.com/static/images/Bo/Book1_17640439306180/Dashboard1/1_rss.png'
                    style='border: none' />
              </a>
            </noscript>

            <object class='tableauViz' style='display:none;'>
              <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
              <param name='embed_code_version' value='3' />
              <param name='site_root' value='' />
              <param name='name' value='Book1_17640439306180/Dashboard1' />
              <param name='tabs' value='no' />
              <param name='toolbar' value='yes' />
              <param name='static_image'
                    value='https://public.tableau.com/static/images/Bo/Book1_17640439306180/Dashboard1/1.png' />
              <param name='animate_transition' value='yes' />
              <param name='display_static_image' value='yes' />
              <param name='display_spinner' value='yes' />
              <param name='display_overlay' value='yes' />
              <param name='display_count' value='yes' />
              <param name='language' value='ja-JP' />
            </object>
          </div>

          <script type='text/javascript'>
            console.log("Tableau script start");
            var divElement = document.getElementById('vizMainDashboard');
            console.log("divElement:", divElement);
            var vizElement = divElement.getElementsByTagName('object')[0];
            console.log("vizElement:", vizElement);

            if (divElement.offsetWidth > 800) {
              vizElement.style.width = '1366px';
              vizElement.style.height = '795px';
            } else if (divElement.offsetWidth > 500) {
              vizElement.style.width = '1366px';
              vizElement.style.height = '795px';
            } else {
              vizElement.style.width = '100%';
              vizElement.style.height = '1277px';
            }

            var scriptElement = document.createElement('script');
            scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
            vizElement.parentNode.insertBefore(scriptElement, vizElement);
          </script>
        </div>
      </div>

      <!-- Additional insights / static image / chart -->
      <div class="card">
        <h3>Key Insights & Notes</h3>
        <p>
          Use this section to display supporting images, summary charts,
          or high-level findings from your analysis.
        </p>

        <% if (typeof extraImageUrl !== 'undefined' && extraImageUrl) { %>
          <img
            src="<%= extraImageUrl %>"
            alt="Insight chart"
            style="width:100%; border-radius:8px; border:1px solid #e5e7eb;">
        <% } else { %>
          <ul>
            <li>Which events generate the highest satisfaction?</li>
            <li>Which participant groups achieve the most milestones?</li>
            <li>Where should Ella Rises focus efforts next?</li>
          </ul>
        <% } %>

      </div>

    </section>
  </main>

</div>
</body>
</html>
